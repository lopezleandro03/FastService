@model FastService.Models.OrdenModel

@using (Ajax.BeginForm("Save", "Ticket", new AjaxOptions { HttpMethod = "Post", OnSuccess = "Done(data)", OnFailure = "OnError", LoadingElementId = "spinner" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-3">
                @Html.LabelFor(model => model.NroOrden)
                @Html.TextBoxFor(model => model.NroOrden, new { @class = "form-control", @id = "ticketid" })
                @Html.ValidationMessageFor(model => model.NroOrden)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.EstadoDesc)
                @Html.TextBoxFor(model => model.EstadoDesc, new { @class = "form-control", @disabled = true })
                @Html.ValidationMessageFor(model => model.EstadoDesc)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.EstadoFecha)
                @Html.TextBoxFor(model => model.EstadoFecha, new { @class = "form-control", @disabled = true })
                @Html.ValidationMessageFor(model => model.EstadoFecha)
            </div>
            <div class="col-md-1">
                @Html.LabelFor(model => model.Domicilio)
                @Html.CheckBoxFor(model => model.Domicilio, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Domicilio)
            </div>
            <div class="col-md-1">
                @Html.LabelFor(model => model.Garantia)
                @Html.CheckBoxFor(model => model.Garantia, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Garantia)
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-3">
                @Html.LabelFor(model => model.Presupuesto)
                @Html.TextBoxFor(model => model.Presupuesto, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Presupuesto)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.Monto)
                @Html.TextBoxFor(model => model.Monto, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Monto)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.ResponsableNombre)
                @Html.DropDownListFor(model => model.ResponsableId, (List<SelectListItem>)ViewBag.ListaResponsables, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.ResponsableId)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.TecnicoNombre)
                @Html.DropDownListFor(model => model.TecnicoId, (List<SelectListItem>)ViewBag.ListaTecnicos, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.TecnicoId)
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">
            <div class="col-md-3">
                <div class="ui-widget ui-front">
                    @Html.LabelFor(model => model.Cliente.Dni)
                    @Html.TextBoxFor(model => model.Cliente.Dni, new { @class = "form-control ac-cliente", @id = "Cliente_Dni" })
                </div>
                @Html.ValidationMessageFor(model => model.Cliente.Dni)
            </div>
            <div class="col-md-3 ui-front">
                @Html.LabelFor(model => model.Cliente.Nombre)
                @Html.TextBoxFor(model => model.Cliente.Nombre, new { @class = "form-control ac-cliente", @id = "Cliente_Nombre" })
                @Html.ValidationMessageFor(model => model.Cliente.Nombre)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.Cliente.Apellido)
                @Html.TextBoxFor(model => model.Cliente.Apellido, new { @class = "form-control ac-cliente", @id = "Cliente_Apellido" })
                @Html.ValidationMessageFor(model => model.Cliente.Apellido)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.Cliente.Mail)
                @Html.TextBoxFor(model => model.Cliente.Mail, new { @class = "form-control ac-cliente", @id = "Cliente_Mail" })
                @Html.ValidationMessageFor(model => model.Cliente.Mail)
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-3">
                @Html.LabelFor(model => model.Cliente.Telefono)
                @Html.TextBoxFor(model => model.Cliente.Telefono, new { @class = "form-control", @id = "Cliente_Telefono" })
                @Html.ValidationMessageFor(model => model.Cliente.Telefono)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.Cliente.Celular)
                @Html.TextBoxFor(model => model.Cliente.Celular, new { @class = "form-control", @id = "Cliente_Celular" })
                @Html.ValidationMessageFor(model => model.Cliente.Celular)
            </div>
            <div class="col-md-6 ui-front">
                @Html.LabelFor(model => model.Cliente.Direccion)
                @Html.TextBoxFor(model => model.Cliente.Direccion, new { @class = "form-control", @id = "Cliente_Direccion", @style = "max-width:700px !important", @placeholder = "Ingrese una direccion" })
                @Html.ValidationMessageFor(model => model.Cliente.Direccion)
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-2">
                @Html.LabelFor(model => model.Cliente.Dir.Calle)
                @Html.TextBoxFor(model => model.Cliente.Dir.Calle, new { @class = "form-control", @id = "route" })
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.Cliente.Dir.Altura)
                @Html.TextBoxFor(model => model.Cliente.Dir.Altura, new { @class = "form-control", @id = "street_number" })
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.Cliente.Dir.Calle2)
                @Html.TextBoxFor(model => model.Cliente.Dir.Calle2, new { @class = "form-control", @id = "calle2" })
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.Cliente.Dir.Calle3)
                @Html.TextBoxFor(model => model.Cliente.Dir.Calle3, new { @class = "form-control", @id = "calle3" })
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.Cliente.Dir.Ciudad)
                @Html.TextBoxFor(model => model.Cliente.Dir.Ciudad, new { @class = "form-control", @id = "locality" })
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.Cliente.Dir.CodigoPostal)
                @Html.TextBoxFor(model => model.Cliente.Dir.CodigoPostal, new { @class = "form-control", @id = "postal_code" })
            </div>

            <div hidden>
                @Html.LabelFor(model => model.Cliente.Dir.Provincia)
                @Html.TextBoxFor(model => model.Cliente.Dir.Provincia, new { @class = "form-control", @id = "administrative_area_level_1" })
            </div>
            <div hidden>
                @Html.LabelFor(model => model.Cliente.Dir.Pais)
                @Html.TextBoxFor(model => model.Cliente.Dir.Pais, new { @class = "form-control", @id = "country" })
            </div>

            <div hidden>
                @Html.HiddenFor(model => model.Cliente.Dir.Latitud, new { @id = "Latitud" })
                @Html.HiddenFor(model => model.Cliente.Dir.Longitud, new { @id = "Longitud" })
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-2">
                @Html.LabelFor(model => model.TipoDesc)
                @Html.DropDownListFor(model => model.TipoId, (List<SelectListItem>)ViewBag.ListaTipoDispositivo, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.TipoId)
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.MarcaDesc)
                @Html.DropDownListFor(model => model.MarcaId, (List<SelectListItem>)ViewBag.ListaMarcas, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.MarcaId)
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.NroSerie)
                @Html.TextBoxFor(model => model.NroSerie, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.NroSerie)
            </div>
            <div class="col-md-2">
                @Html.LabelFor(model => model.Modelo)
                @Html.TextBoxFor(model => model.Modelo, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Modelo)
            </div>
            <div class="col-md-1">
                @Html.LabelFor(model => model.Ubicacion)
                @Html.TextBoxFor(model => model.Ubicacion, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Ubicacion)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.Accesorios)
                @Html.TextAreaFor(model => model.Accesorios, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Accesorios)
            </div>
        </div>
    </div>

    <div hidden id="datosComercioDiv">

        <div class="row">
            <div class="col-md-12">
                <div class="col-md-3">
                    @Html.LabelFor(model => model.Comercio.Descripcion)
                    @Html.DropDownListFor(model => model.Comercio.ComercioId, (List<SelectListItem>)ViewBag.ListaComercio, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Comercio.ComercioId)
                </div>
                <div class="col-md-3">
                    @Html.LabelFor(model => model.Comercio.Telefono)
                    @Html.TextBoxFor(model => model.Comercio.Telefono, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Comercio.Telefono)
                </div>
                <div class="col-md-3">
                    @Html.LabelFor(model => model.FechaCompra)
                    @Html.TextBoxFor(model => model.FechaCompra, new { @class = "form-control form-control-inline input-large date-picker" })
                    @Html.ValidationMessageFor(model => model.FechaCompra)
                </div>
            </div>
        </div>
    </div>

    <br>

    <div class="form-actions">
        <div class="row">
            <div class="col-md-12 text-center">
                <input id="btnGuardarOrden" class="btn btn-success" type="submit" value="GUARDAR" style="display:none" />
            </div>
        </div>
    </div>
}

<div id="divNovedades">
    @RenderPage("Novedades.cshtml", Model)
</div>

<style>
    form .row {
        padding-top: 10px;
    }
</style>

<script src="~/Content/assets/pages/scripts/components-date-time-pickers.min.js"></script>
<script src="~/Content/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<link href="~/Content/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

<script>
    function Done(data) {
        $("#modalSuccess").modal();
        $(".modal-backdrop").hide();
        $("#OrdenDetailBody").html(data);
    }

    $(".ac-cliente").autocomplete({
        source: function (request, response) {
            $.ajax({
                url: "/Cliente/Index",
                type: "POST",
                dataType: "json",
                data: { Prefix: request.term },
                success: function (data) {
                    response($.map(data, function (item) {
                        return { label: item.DisplayName, value: item.Dni };
                    }))

                }
            })
        },
        select: function (event, ui) {
            ui.item.value;
            $.ajax({
                url: "/Cliente/Get",
                type: "POST",
                dataType: "json",
                data: { ClienteId: ui.item.value },
                success: function (data) {
                    $("#Cliente_Dni").val(data.Dni);
                    $("#Cliente_Nombre").val(data.Nombre);
                    $("#Cliente_Apellido").val(data.Apellido);
                    $("#Cliente_Mail").val(data.Mail);
                    $("#Cliente_Telefono").val(data.Telefono);
                    $("#Cliente_Celular").val(data.Celular);
                    $("#Cliente_Direccion").val(data.Direccion);
                    $("#route").val(data.Calle);
                    $("#street_number").val(data.Altura);
                    $("#locality").val(data.Provincia);
                    $("#postal_code").val(data.CodigoPostal); calle3
                    //$("#administrative_area_level_1").val(data.CodigoPostal);
                    $("#country").val(data.Pais);
                    $("#calle2").val(data.Calle2);
                    $("#calle3").val(data.Calle3);
                }
            })
        },
    });

    $(function () {
        if ("@Model.Garantia" == "True") {
            $("#datosComercioDiv").removeAttr("hidden", true);
        }

        $("#OrdenActiva_Garantia").click(function () {
            if ($("#OrdenActiva_Garantia").prop("checked")) {
                $("#datosComercioDiv").removeAttr("hidden", true);
            } else {
                $("#datosComercioDiv").attr("hidden", true);
            }
        })

        $.ajax({
            url: "@Url.Action("AutoCompleteAddress", "GoogleMaps")/Cliente_Direccion",
            success: function (data) {
                $("#OrdenDetail").append(data); //This is where to append the component required for maps autocomplete
            }
        });
    })
</script>

