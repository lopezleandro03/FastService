@model FastService.Models.OrdenesIndexViewModel

@using (Ajax.BeginForm("Save", "Reparacion", new AjaxOptions { HttpMethod = "Post", OnSuccess = "Done(data)", OnFailure = "OnError", LoadingElementId = "spinner" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <h3>Estado y Asignacion</h3>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.NroOrden)
                @Html.TextBoxFor(model => model.OrdenActiva.NroOrden, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.NroOrden)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.EstadoDesc)
                @Html.TextBoxFor(model => model.OrdenActiva.EstadoDesc, new { @class = "form-control", @disabled = true })
                @Html.ValidationMessageFor(model => model.OrdenActiva.EstadoDesc)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.EstadoFecha)
                @Html.TextBoxFor(model => model.OrdenActiva.EstadoFecha, new { @class = "form-control", @disabled = true })
                @Html.ValidationMessageFor(model => model.OrdenActiva.EstadoFecha)
            </div>
            <div class="col-md-1">
                @Html.LabelFor(model => model.OrdenActiva.Domicilio)
                @Html.CheckBoxFor(model => model.OrdenActiva.Domicilio, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.Domicilio)
            </div>
            <div class="col-md-1">
                @Html.LabelFor(model => model.OrdenActiva.Garantia)
                @Html.CheckBoxFor(model => model.OrdenActiva.Garantia, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.Garantia)
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.Presupuesto)
                @Html.TextBoxFor(model => model.OrdenActiva.Presupuesto, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.Presupuesto)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.Monto)
                @Html.TextBoxFor(model => model.OrdenActiva.Monto, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.Monto)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.ResponsableNombre)
                @Html.DropDownListFor(model => model.OrdenActiva.ResponsableId, (List<SelectListItem>)ViewBag.ListaResponsables, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.ResponsableId)
            </div>
            <div class="col-md-3">
                @Html.LabelFor(model => model.OrdenActiva.TecnicoNombre)
                @Html.DropDownListFor(model => model.OrdenActiva.TecnicoId, (List<SelectListItem>)ViewBag.ListaTecnicos, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.OrdenActiva.TecnicoId)
            </div>
        </div>
    </div>


    <h3 class="form-section">
        Cliente
    </h3>
        <hr>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-3">
                    <div class="ui-widget">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dni)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dni, new { @class = "form-control ac-cliente", @id = "Cliente_Dni" })
                    </div>
                    @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Dni)
                </div>
                <div class="col-md-3">
                    @Html.LabelFor(model => model.OrdenActiva.Cliente.Nombre)
                    @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Nombre, new { @class = "form-control ac-cliente", @id = "Cliente_Nombre" })
                    @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Nombre)
                </div>
                <div class="col-md-3">
                    @Html.LabelFor(model => model.OrdenActiva.Cliente.Apellido)
                    @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Apellido, new { @class = "form-control ac-cliente", @id = "Cliente_Apellido" })
                    @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Apellido)
                </div>
                <div class="col-md-3">
                    @Html.LabelFor(model => model.OrdenActiva.Cliente.Mail)
                    @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Mail, new { @class = "form-control ac-cliente", @id = "Cliente_Mail" })
                    @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Mail)
                </div>
            </div>
        </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Telefono)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Telefono, new { @class = "form-control", @id = "Cliente_Telefono" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Telefono)
                    </div>
                    <div class="col-md-3">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Celular)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Celular, new { @class = "form-control", @id = "Cliente_Celular" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Celular)
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Direccion)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Direccion, new { @class = "form-control", @id = "Cliente_Direccion", @style = "max-width:700px !important", @placeholder = "Ingrese una direccion" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.Cliente.Direccion)
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dir.Calle)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dir.Calle, new { @class = "form-control", @id = "route" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dir.Altura)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dir.Altura, new { @class = "form-control", @id = "street_number" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dir.Ciudad)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dir.Ciudad, new { @class = "form-control", @id = "locality" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dir.CodigoPostal)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dir.CodigoPostal, new { @class = "form-control", @id = "postal_code" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dir.Provincia)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dir.Provincia, new { @class = "form-control", @id = "administrative_area_level_1" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Cliente.Dir.Pais)
                        @Html.TextBoxFor(model => model.OrdenActiva.Cliente.Dir.Pais, new { @class = "form-control", @id = "country" })
                    </div>

                    <div hidden>
                        @Html.HiddenFor(model => model.OrdenActiva.Cliente.Dir.Latitud, new { @id = "Latitud" })
                        @Html.HiddenFor(model => model.OrdenActiva.Cliente.Dir.Longitud, new { @id = "Longitud" })
                    </div>
                </div>

            </div>

            <h3 class="form-section">Aparato</h3>
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.TipoDesc)
                        @Html.DropDownListFor(model => model.OrdenActiva.TipoId, (List<SelectListItem>)ViewBag.ListaTipoDispositivo, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.TipoId)
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.MarcaDesc)
                        @Html.DropDownListFor(model => model.OrdenActiva.MarcaId, (List<SelectListItem>)ViewBag.ListaMarcas, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.MarcaId)
                    </div>
                    <div class="col-md-3">
                        @Html.LabelFor(model => model.OrdenActiva.NroSerie)
                        @Html.TextBoxFor(model => model.OrdenActiva.NroSerie, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.NroSerie)
                    </div>
                    <div class="col-md-3">
                        @Html.LabelFor(model => model.OrdenActiva.Modelo)
                        @Html.TextBoxFor(model => model.OrdenActiva.Modelo, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.Modelo)
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.OrdenActiva.Ubicacion)
                        @Html.TextBoxFor(model => model.OrdenActiva.Ubicacion, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.OrdenActiva.Ubicacion)
                    </div>
                </div>
            </div>

            <div hidden id="datosComercioDiv">

                <h3 class="form-section">Comercio</h3>
                <hr>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-3">
                            @Html.LabelFor(model => model.OrdenActiva.Comercio.Descripcion)
                            @Html.DropDownListFor(model => model.OrdenActiva.Comercio.ComercioId, (List<SelectListItem>)ViewBag.ListaComercio, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.OrdenActiva.Comercio.ComercioId)
                        </div>
                        <div class="col-md-3">
                            @Html.LabelFor(model => model.OrdenActiva.Comercio.Code)
                            @Html.TextBoxFor(model => model.OrdenActiva.Comercio.Code, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.OrdenActiva.Comercio.Code)
                        </div>
                        <div class="col-md-3">
                            @Html.LabelFor(model => model.OrdenActiva.Comercio.Telefono)
                            @Html.TextBoxFor(model => model.OrdenActiva.Comercio.Telefono, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.OrdenActiva.Comercio.Telefono)
                        </div>
                    </div>
                </div>
            </div>

            <br>

            <div class="form-actions">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <input id="btnGuardarOrden" class="btn btn-success" type="submit" value="GUARDAR" style="display:none" />
                    </div>
                </div>
            </div>
}

@if (!Model.NuevaOrden)
{
    <h3 class="form-section">Novedades</h3>
    <div class="row ListaNovedades">
        <div class="col-md-12">
            @if (Model.OrdenActiva.Novedades != null && Model.OrdenActiva.Novedades.Any())
            {
                <table class="table table-bordered">
                    <tr>
                        <th class="col-xs-3">
                            @Html.DisplayNameFor(model => model.OrdenActiva.Novedades.First().Fecha)
                        </th>
                        <th class="col-xs-2">
                            @Html.DisplayNameFor(model => model.OrdenActiva.Novedades.First().Descripcion)
                        </th>
                        <th class="col-xs-2">
                            @Html.DisplayNameFor(model => model.OrdenActiva.Novedades.First().Monto)
                        </th>
                        <th class="col-xs-6">
                            @Html.DisplayNameFor(model => model.OrdenActiva.Novedades.First().Observacion)
                        </th>
                    </tr>

                    @foreach (var item in Model.OrdenActiva.Novedades)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(Item => item.Fecha)
                            </td>
                            <td>
                                @Html.DisplayFor(Item => item.Descripcion)
                            </td>
                            <td>
                                @Html.DisplayFor(Item => item.Monto)
                            </td>
                            <td>
                                @Html.DisplayFor(Item => item.Observacion)
                            </td>
                        </tr>
                    }
                </table>
            }
            else
            {
                <h4> No hay novedades cargadas para esta orden</h4>
            }
        </div>
    </div>

}


<style>
    .ListaNovedades {
        max-height: 150px;
        overflow-y: scroll;
    }

    form .row {
        padding-top: 10px;
    }
</style>

<script>

    $(".ac-cliente").autocomplete({
        source: function (request, response) {
            $.ajax({
                url: "/Cliente/Index",
                type: "POST",
                dataType: "json",
                data: { Prefix: request.term },
                success: function (data) {
                    response($.map(data, function (item) {
                        return { label: item.DisplayName, value: item.Dni };
                    }))

                }
            })
        },
        select: function (event, ui) {
            ui.item.value;
            $.ajax({
                url: "/Cliente/Get",
                type: "POST",
                dataType: "json",
                data: { ClienteId: ui.item.value },
                success: function (data) {
                    $("#Cliente_Dni").val(data.Dni);
                    $("#Cliente_Nombre").val(data.Nombre);
                    $("#Cliente_Apellido").val(data.Apellido);
                    $("#Cliente_Mail").val(data.Mail);
                    $("#Cliente_Telefono").val(data.Telefono);
                    $("#Cliente_Celular").val(data.Celular);
                    $("#Cliente_Direccion").val(data.Direccion);
                }
            })
        },
    });

    function Done(data) {
        alert("Guardado con exito!");
        $(".page-content").html(data);
    }

    function OnError(data) {
        alert("Ocurrio un error intentado grabar los cambios, intente de nuevo!");
    }

    $(function () {
        if ("@Model.OrdenActiva.Garantia" == "True") {
            $("#datosComercioDiv").removeAttr("hidden", true);
        }

        $("#OrdenActiva_Garantia").click(function () {
            if ($("#OrdenActiva_Garantia").prop("checked")) {
                $("#datosComercioDiv").removeAttr("hidden", true);
            } else {
                $("#datosComercioDiv").attr("hidden", true);
            }
        })

          $.ajax({
              url: "@Url.Action("AutoCompleteAddress", "GoogleMaps")/Cliente_Direccion",
              success: function (data) {
                  $("#OrdenResumen").append(data);
                }
            });
            @*$("#LocalizeButton").click(function () {

                    $.ajax({
                        url: "@Url.Action("AutoCompleteAddressFormModal", "GoogleMaps")",
                        success: function (data) {
                            $("#modalSearchMap").html(data);
                            $("#modalSearchMap").modal();
                        }
                    });

                });*@
    })
</script>

<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
