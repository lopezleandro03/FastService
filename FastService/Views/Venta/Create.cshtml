@model FastService.Models.VentaModel

<script src="~/Content/assets/pages/scripts/components-date-time-pickers.min.js"></script>
<script src="~/Content/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<link href="~/Content/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet" />

@using (Ajax.BeginForm("Create", "Venta", new AjaxOptions { HttpMethod = "Post", OnSuccess = "OnSuccess(data)", OnFailure = "OnError" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="portlet-body form">
        <form action="#" class="form-horizontal">
            <div class="form-body">
                <h3 class="form-section">Venta</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group ">
                            @Html.LabelFor(model => model.Origen, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.DropDownListFor(Model => Model.Origen, (List<SelectListItem>)ViewBag.PuntoDeVentaList, new { @class = "form-control" })
                                <span class="help-block"> Comercio donde se genera la venta </span>
                                @Html.ValidationMessageFor(model => model.Origen)
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(model => model.Monto, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Monto, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Monto)
                            </div>
                        </div>
                        <!--/span-->
                    </div>
                </div>
                <!--/row-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Descripcion, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextAreaFor(model => model.Descripcion, new { @class = "form-control" })
                                <span class="help-block"> Breve descripcion de la venta </span>
                                @Html.ValidationMessageFor(model => model.Descripcion)
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Fecha, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Fecha, new { @class = "form-control form-control-inline input-large date-picker", @text = DateTime.Now, @placeholder = "Seleccione una fecha" })

                            </div>
                            @*<input type="text" class="form-control" placeholder="@DateTime.Now">*@
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group ">
                                @Html.LabelFor(model => model.MetodoDePago, new { @class = "control-label col-md-6" })
                           
                            <div class="col-md-6">
                                @Html.DropDownListFor(Model => Model.MetodoDePagoId, (List<SelectListItem>)ViewBag.MetodoDePagoList, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.MetodoDePagoId)
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group ">
                            @Html.LabelFor(model => model.NroFactura, new { @class = "control-label col-md-4" })
                            <div class="col-md-8">
                                @Html.TextBoxFor(Model => Model.NroFactura, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.NroFactura)
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group ">
                            @Html.LabelFor(model => model.TipoDeFactura, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.DropDownListFor(Model => Model.TipoDeFacturaId, (List<SelectListItem>)ViewBag.ListaTipoFactura, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.TipoDeFacturaId)
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group ">
                            @Html.LabelFor(model => model.Facturado, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.CheckBoxFor(model => model.Facturado, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Facturado)
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="form-section">Cliente</h3>
                <!--/row-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Dni, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Dni, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Dni)
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Nombre, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Nombre, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Nombre)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Apellido, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Apellido, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Apellido)
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Mail, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Mail, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Mail)
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Telefono, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Telefono, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Telefono)
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Celular, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Celular, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Celular)
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <!--/row-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(Model => Model.Cliente.Direccion, new { @class = "control-label col-md-3" })
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.Cliente.Direccion, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.Cliente.Direccion)
                            </div>
                        </div>
                    </div>
                </div>

                <br />

                <div class="form-actions">
                    <div class="row">
                        <div class="col-md-12 text-right">
                            <input id="btnNuevaVenta" class="btn btn-info btn-md" type="submit" value="ACEPTAR" />
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- END FORM-->
    </div>
}


<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

<script type="text/javascript">
    $("#Cliente_Dni").autocomplete({
        source: function (request, response) {
            $.ajax({
                url: "/Cliente/Index",
                type: "POST",
                dataType: "json",
                data: { Prefix: request.term },
                success: function (data) {
                    response($.map(data, function (item) {
                        return { label: item.DisplayName, value: item.Dni };
                    }))

                }
            })
        },
        select: function (event, ui) {
            ui.item.value;
            $.ajax({
                url: "/Cliente/Get",
                type: "POST",
                dataType: "json",
                data: { ClienteId: ui.item.value },
                success: function (data) {
                    console.info(data);
                    $("#Cliente_Nombre").val(data.Nombre);
                    $("#Cliente_Apellido").val(data.Apellido);
                    $("#Cliente_Mail").val(data.Mail);
                    $("#Cliente_Telefono").val(data.Telefono);
                    $("#Cliente_Celular").val(data.Celular);
                    $("#Cliente_Direccion").val(data.Direccion);
                }
            })
        },
    });

    function OnSuccess(data) {
        $("#modalSuccess").modal();
        //$(".modal-backdrop").hide();
        $(".page-content").html(data);
    }

    //function OnError() {
    //    $("#modalError").modal();
    //    //$(".modal-backdrop").hide();
    //}

</script>